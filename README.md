# Myelin Base - RAG Application Backend

<p align="center">
  <img src="https://img.shields.io/badge/TypeScript-5.9-blue?logo=typescript" alt="TypeScript" />
  <img src="https://img.shields.io/badge/AWS%20SAM-Serverless-orange?logo=amazonaws" alt="AWS SAM" />
  <img src="https://img.shields.io/badge/Node.js-20.x-green?logo=nodedotjs" alt="Node.js" />
  <img src="https://img.shields.io/badge/License-MIT-yellow" alt="License" />
</p>

## ğŸŒ Live Demo

| ç’°å¢ƒ                   | URL                                              |
| ---------------------- | ------------------------------------------------ |
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**   | [https://myelinbase.com](https://myelinbase.com) |
| **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** | `https://api.myelinbase.com`                     |

> ğŸ“¦ **é–¢é€£ãƒªãƒã‚¸ãƒˆãƒª**: [frontend](https://github.com/r-serori/myelinbase-frontend) - Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

---

AWS Serverless RAGï¼ˆRetrieval-Augmented Generationï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€éåŒæœŸå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€AI ã«ã‚ˆã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph Client["ğŸ–¥ï¸ Client"]
        Frontend["Next.js 16<br/>React 19 / TypeScript"]
    end

    subgraph Vercel["â˜ï¸ Vercel"]
        VercelEdge["Edge Network<br/>myelinbase.com"]
    end

    subgraph AWS["â˜ï¸ AWS Cloud (ap-northeast-1)"]
        subgraph Auth["ğŸ” Authentication"]
            Cognito["Amazon Cognito<br/>User Pool"]
        end

        subgraph API["ğŸŒ API Layer"]
            APIGW["API Gateway<br/>api.myelinbase.com"]
            ChatURL["Lambda Function URL<br/>Streamingå¯¾å¿œ"]
        end

        subgraph Compute["âš¡ Compute"]
            DocLambda["Documents Lambda<br/>CRUDæ“ä½œ"]
            ChatLambda["Chat Lambda<br/>ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”Ÿæˆ"]
            ChatSessionsLambda["Chat Sessions Lambda<br/>ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†"]
            TriggerLambda["Trigger Lambda<br/>SQSã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†"]
            CleanupLambda["Cleanup Lambda<br/>ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤"]
        end

        subgraph Messaging["ğŸ“¨ Messaging"]
            SQS["SQS Queue<br/>Document Ingestion"]
            DLQ["Dead Letter Queue"]
        end

        subgraph Orchestration["ğŸ”„ Orchestration"]
            StepFunctions["Step Functions<br/>RAG Pipeline"]
        end

        subgraph Storage["ğŸ’¾ Storage"]
            S3["Amazon S3<br/>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿å­˜"]
            DynamoDB["DynamoDB<br/>ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ / å±¥æ­´"]
        end

        subgraph Secrets["ğŸ”‘ Secrets"]
            SSM["SSM Parameter Store<br/>Pinecone API Key"]
        end

        subgraph AI["ğŸ¤– AI Services"]
            Bedrock["Amazon Bedrock<br/>Claude 3 Haiku<br/>Titan Embeddings"]
        end
    end

    subgraph External["ğŸŒ External"]
        Pinecone["Pinecone<br/>Vector Database"]
    end

    Frontend --> VercelEdge
    VercelEdge --> APIGW
    VercelEdge --> ChatURL

    APIGW --> Cognito
    APIGW --> DocLambda
    APIGW --> ChatSessionsLambda
    ChatURL --> ChatLambda

    DocLambda --> DynamoDB
    DocLambda --> S3

    S3 -->|ObjectCreated| SQS
    SQS --> TriggerLambda
    SQS -.-> DLQ
    TriggerLambda --> StepFunctions
    StepFunctions --> S3
    StepFunctions --> DynamoDB
    StepFunctions --> Bedrock
    StepFunctions --> Pinecone
    StepFunctions --> SSM

    ChatLambda --> DynamoDB
    ChatLambda --> Bedrock
    ChatLambda --> Pinecone
    ChatLambda --> SSM

    ChatSessionsLambda --> DynamoDB

    DynamoDB -->|Streams REMOVE| CleanupLambda
    CleanupLambda --> S3
    CleanupLambda --> Pinecone

    style Client fill:#e1f5fe
    style Vercel fill:#f3e5f5
    style AWS fill:#fff3e0
    style External fill:#e8f5e9
```

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ â†’ RAGå‡¦ç†

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant API as API Gateway
    participant L as Documents Lambda
    participant S3 as S3
    participant SQS as SQS Queue
    participant T as Trigger Lambda
    participant SF as Step Functions
    participant B as Bedrock
    participant PC as Pinecone
    participant DB as DynamoDB

    U->>F: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    F->>API: POST /documents/upload
    API->>L: ç½²åä»˜ãURLç™ºè¡Œ
    L->>DB: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (PENDING_UPLOAD)
    L-->>F: ç½²åä»˜ãURL
    F->>S3: PUT (ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)

    S3->>SQS: ObjectCreated Event
    SQS->>T: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
    T->>SF: RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é–‹å§‹
    SF->>S3: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
    SF->>SF: ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²
    SF->>B: Embeddingç”Ÿæˆ
    SF->>PC: ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜
    SF->>DB: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° (COMPLETED)
```

#### AIãƒãƒ£ãƒƒãƒˆï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ï¼‰

```mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant C as Chat Lambda
    participant B as Bedrock
    participant PC as Pinecone
    participant DB as DynamoDB

    U->>F: è³ªå•å…¥åŠ›
    F->>C: POST (Function URL)
    C->>B: ã‚¯ã‚¨ãƒªEmbeddingç”Ÿæˆ
    C->>PC: é¡ä¼¼ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
    PC-->>C: é–¢é€£ãƒãƒ£ãƒ³ã‚¯
    C->>B: Claude 3 (with context)

    loop Streaming
        B-->>C: Token
        C-->>F: SSE
        F-->>U: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
    end

    C->>DB: å±¥æ­´ä¿å­˜
```

---

## ğŸ“‹ ç›®æ¬¡

- [æ¦‚è¦](#æ¦‚è¦)
- [ä¸»ãªæ©Ÿèƒ½](#ä¸»ãªæ©Ÿèƒ½)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
- [ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ](#ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ)
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
- [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
- [ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³](#ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³)

## æ¦‚è¦

Myelin Base ã¯ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºãƒ»ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²ãƒ»ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãŒè¡Œã‚ã‚Œã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ AI ã¨ãƒãƒ£ãƒƒãƒˆãŒã§ãã‚‹ RAG ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- ğŸ“„ **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†** - PDF/ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¿ã‚°ç®¡ç†ã€ç½²åä»˜ãURLã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€é‡è¤‡æ¤œçŸ¥
- ğŸ¤– **RAG ãƒãƒ£ãƒƒãƒˆ** - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ãªãŒã‚‰ AI ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒãƒ£ãƒƒãƒˆï¼ˆVercel AI SDK äº’æ›ï¼‰
- âš™ï¸ **éåŒæœŸå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³** - AWS Step Functions ã«ã‚ˆã‚‹å …ç‰¢ãª ETL ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º â†’ ãƒãƒ£ãƒ³ã‚¯åˆ†å‰² â†’ ãƒ™ã‚¯ãƒˆãƒ«åŒ– â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ï¼‰
- ğŸ” **èªè¨¼ãƒ»èªå¯** - Amazon Cognito ã«ã‚ˆã‚‹å®‰å…¨ãªãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢
- âš¡ **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹** - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§å¾“é‡èª²é‡‘ã®ã‚³ã‚¹ãƒˆåŠ¹ç‡ã®è‰¯ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ğŸ³ **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º** - LocalStack ã¨ DynamoDB Local ã«ã‚ˆã‚‹å®Œå…¨ãªãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Frontend (Next.js)                          â”‚
â”‚                         https://myelinbase.com                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTPS
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS Cloud                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Gateway   â”‚  â”‚ Lambda Function â”‚  â”‚   Amazon Cognito         â”‚  â”‚
â”‚  â”‚  REST API      â”‚  â”‚ URL (Streaming) â”‚  â”‚   User Authentication    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                    â”‚                                          â”‚
â”‚          â–¼                    â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      Lambda Functions                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚Documents â”‚ â”‚  Chat    â”‚ â”‚ Trigger  â”‚ â”‚ Cleanup  â”‚ â”‚  Chat    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  API     â”‚ â”‚ Agent    â”‚ â”‚ (SQS)    â”‚ â”‚(Streams) â”‚ â”‚ Sessions â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Amazon S3  â”‚  â”‚  DynamoDB   â”‚  â”‚    SQS      â”‚  â”‚ Step Functions  â”‚ â”‚
â”‚  â”‚  Documents  â”‚  â”‚  Metadata   â”‚  â”‚  + DLQ      â”‚  â”‚  RAG Pipeline   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Amazon Bedrock         â”‚  â”‚    SSM Parameter Store          â”‚   â”‚
â”‚  â”‚  Claude 3 / Titan Embed     â”‚  â”‚    Secrets Management           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       Pinecone        â”‚
                    â”‚    Vector Database    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‡¦ç†ãƒ•ãƒ­ãƒ¼è©³ç´°

#### 1. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```text
Client â†’ API Gateway â†’ Documents Lambda
  â†“
1. ç½²åä»˜ãURLç™ºè¡Œ
  â†“
Client â†’ S3 (ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)
  â†“
S3 Event â†’ SQS Queue â†’ Trigger Lambda
  â†“
Step Functions (RAG Pipeline)
  â”œâ”€ ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º (PDF â†’ Text)
  â”œâ”€ ãƒãƒ£ãƒ³ã‚¯åˆ†å‰² (Overlapping Window)
  â”œâ”€ ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ç”Ÿæˆ (Bedrock Titan)
  â””â”€ ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜ (Pinecone)
  â†“
DynamoDB ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° (COMPLETED)
```

#### 2. ãƒãƒ£ãƒƒãƒˆãƒ•ãƒ­ãƒ¼

```text
Client â†’ Chat Lambda (Function URL)
  â†“
1. ã‚¯ã‚¨ãƒªã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ç”Ÿæˆ (Bedrock Titan)
  â†“
2. Pinecone ã§é¡ä¼¼ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢
  â†“
3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰
  â†“
4. Bedrock Claude ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ç”Ÿæˆ
  â†“
5. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã‚’ DynamoDB ã«ä¿å­˜
```

#### 3. å‰Šé™¤ãƒ•ãƒ­ãƒ¼

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: è«–ç†å‰Šé™¤ï¼ˆåŒæœŸï¼‰                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. DELETE /documents/{id} ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡                    â”‚
â”‚     â†“                                                         â”‚
â”‚  2. DynamoDB: status ã‚’ DELETED ã«æ›´æ–°                       â”‚
â”‚     - TTL ã‚’è¨­å®šï¼ˆ24æ™‚é–“å¾Œã«è‡ªå‹•å‰Šé™¤ï¼‰                        â”‚
â”‚     â†“                                                         â”‚
â”‚  3. å³åº§ã« 202 Accepted ã‚’è¿”å´                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: ç‰©ç†å‰Šé™¤ï¼ˆéåŒæœŸï¼‰                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. TTL ã«ã‚ˆã‚Š DynamoDB ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å‰Šé™¤                   â”‚
â”‚     â†“                                                         â”‚
â”‚  5. DynamoDB Streams: REMOVE ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«                     â”‚
â”‚     â†“                                                         â”‚
â”‚  6. Cleanup Lambda ãŒèµ·å‹•:                                    â”‚
â”‚     - S3 ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤                                         â”‚
â”‚     - Pinecone ãƒ™ã‚¯ãƒˆãƒ«å‰Šé™¤ï¼ˆdocumentId ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰     â”‚
â”‚     - ä¸¦åˆ—å‡¦ç†ã§å®Ÿè¡Œï¼ˆä¸€æ–¹ãŒå¤±æ•—ã—ã¦ã‚‚ä»–æ–¹ã¯ç¶™ç¶šï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è©³ç´°ã¯å„é–¢æ•°ã® README ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- [Trigger Function](./infrastructure/src/functions/trigger/README.md)
- [Cleanup Function](./infrastructure/src/functions/cleanup/README.md)

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª               | æŠ€è¡“                                              |
| ---------------------- | ------------------------------------------------- |
| **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **         | Node.js 20.x / TypeScript 5.9                     |
| **IaC**                | AWS SAM (Serverless Application Model)            |
| **ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°** | AWS Lambda (arm64)                                |
| **API**                | API Gateway REST API                              |
| **èªè¨¼**               | Amazon Cognito                                    |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**       | DynamoDB                                          |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**         | Amazon S3                                         |
| **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°**     | Amazon SQS (+ Dead Letter Queue)                  |
| **AI/ML**              | Amazon Bedrock (Claude 3 Haiku, Titan Embeddings) |
| **ãƒ™ã‚¯ãƒˆãƒ«DB**         | Pinecone                                          |
| **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†**   | AWS Systems Manager Parameter Store               |
| **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**       | AWS Step Functions                                |
| **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º**       | LocalStack, Docker Compose                        |

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 5åˆ†ã§å§‹ã‚ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd myelinbase-backend

# 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
npm run local:start

# 4. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:local

# 5. SAM Local API ã®èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
npm run api:start
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—) - è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
2. [API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ](#api-ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ) - API ã®ä½¿ç”¨æ–¹æ³•
3. [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³) - é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
myelinbase-backend/
â”œâ”€â”€ infrastructure/              # AWS SAM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ & Lambdaé–¢æ•°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ functions/          # Lambdaé–¢æ•°ç¾¤
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/           # ãƒãƒ£ãƒƒãƒˆAPI (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts    # ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ index.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ README.md   # é–¢æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ chat-sessions/  # ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ documents/      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ cleanup/        # DynamoDB Streams ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”‚   â”‚   â”‚   â”œâ”€â”€ trigger/        # SQSã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼
â”‚   â”‚   â””â”€â”€ shared/             # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ & ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚       â”œâ”€â”€ clients/         # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚       â”‚   â”œâ”€â”€ bedrock.ts   # AWS Bedrock
â”‚   â”‚       â”‚   â””â”€â”€ pinecone.ts # Pinecone
â”‚   â”‚       â”œâ”€â”€ schemas/        # Zod ã‚¹ã‚­ãƒ¼ãƒ
â”‚   â”‚       â”œâ”€â”€ types/           # TypeScript å‹å®šç¾©
â”‚   â”‚       â””â”€â”€ utils/           # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ template.yaml            # SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (AWSç’°å¢ƒ)
â”‚   â”œâ”€â”€ template-local.yaml      # SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ)
â”‚   â”œâ”€â”€ samconfig.toml           # SAMãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
â”‚   â””â”€â”€ README.md                # ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ local-dev/                   # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
â”‚   â”œâ”€â”€ docker-compose.yml       # Docker Compose è¨­å®š
â”‚   â”œâ”€â”€ scripts/                 # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”‚   â””â”€â”€ deploy-local.sh      # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ env.local.json           # SAM Local ç’°å¢ƒå¤‰æ•°
â”‚   â””â”€â”€ LOCAL_DEVELOPMENT.md     # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ doc/                         # API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ openapi.yaml             # OpenAPIä»•æ§˜
â”‚   â””â”€â”€ API_RESPONSE_GUIDE.md    # API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰
â””â”€â”€ package.json                 # npm workspacesè¨­å®š
```

### ä¸»è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®èª¬æ˜

- **`infrastructure/src/functions/`**: å„ Lambda é–¢æ•°ã®å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ
- **`infrastructure/src/shared/`**: å…¨é–¢æ•°ã§å…±æœ‰ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆLambda Layerï¼‰
- **`local-dev/`**: LocalStack ã¨ DynamoDB Local ã‚’ä½¿ã£ãŸãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
- **`doc/`**: API ä»•æ§˜æ›¸ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

å„é–¢æ•°ã®è©³ç´°ã¯ã€å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã® `README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

#### å¿…é ˆãƒ„ãƒ¼ãƒ«

- **Node.js** 20.x ä»¥ä¸Š
- **Docker** & Docker Compose (ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨)
- **AWS CLI** v2 ä»¥ä¸Š
- **AWS SAM CLI** 1.100.0 ä»¥ä¸Š
- **Git**

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«

- **LocalStack CLI** (awslocal ã‚³ãƒãƒ³ãƒ‰ç”¨)
- **AWS Account** (AWSç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚)

### åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd myelinbase-backend

# 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
cp .env.example .env
```

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

#### 1. Docker ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

```bash
# LocalStack ã¨ DynamoDB Local ã‚’èµ·å‹•
npm run local:start

# èµ·å‹•ç¢ºèª
docker-compose ps
```

#### 2. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# LocalStack ã«ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:local

# ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
# ä¾‹: http://localhost:4566/restapis/<api-id>/local/_user_request_/
```

#### 3. SAM Local API ã®èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰

```bash
# API Gateway ã‚’ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
npm run api:start

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ http://localhost:3000 ã§èµ·å‹•
```

#### 4. å‹•ä½œç¢ºèª

```bash
curl http://localhost:3000
```

### AWS é–‹ç™ºç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

#### äº‹å‰æº–å‚™

1. **AWS èªè¨¼æƒ…å ±ã®è¨­å®š**

```bash
aws configure
# AWS Access Key ID
# AWS Secret Access Key
# Default region: ap-northeast-1
# Default output format: json
```

2. **SSM Parameter Store ã« Pinecone API ã‚­ãƒ¼ã‚’ä¿å­˜**

```bash
aws ssm put-parameter \
  --name /myelinbase/dev/pinecone-api-key \
  --value "your-pinecone-api-key" \
  --type SecureString \
  --region ap-northeast-1
```

3. **Pinecone ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ**

Pinecone ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã€`PINECONE_INDEX_NAME` ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã—ã¾ã™ã€‚

#### ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# develop ãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆ
git checkout develop

# ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy:dev

# ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†å¾Œã€å‡ºåŠ›ã•ã‚Œã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç¢ºèª
# - ApiEndpoint: API Gateway ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
# - ChatAgentEndpoint: Chat Function URL
```

### æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

#### äº‹å‰æº–å‚™

1. **æœ¬ç•ªç’°å¢ƒç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®š**

`infrastructure/samconfig.toml` ã® `[prod.deploy.parameters]` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªãƒ»æ›´æ–°ã—ã¾ã™ã€‚

2. **æœ¬ç•ªç”¨ SSM Parameter ã®ä½œæˆ**

```bash
aws ssm put-parameter \
  --name /myelinbase/prod/pinecone-api-key \
  --value "your-production-pinecone-api-key" \
  --type SecureString \
  --region ap-northeast-1
```

#### ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# main ãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆ
git checkout main

# ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚ã‚Šï¼‰
npm run deploy:prod
```

> **æ³¨æ„**: æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¯æ…é‡ã«è¡Œã£ã¦ãã ã•ã„ã€‚`samconfig.toml` ã§ `confirm_changeset = true` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›´å†…å®¹ã®ç¢ºèªãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

## npm ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

| ã‚³ãƒãƒ³ãƒ‰               | èª¬æ˜                                            |
| ---------------------- | ----------------------------------------------- |
| `npm run local:start`  | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’èµ·å‹• (LocalStack, DynamoDB Local) |
| `npm run local:stop`   | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’åœæ­¢                              |
| `npm run local:reset`  | ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’ãƒªã‚»ãƒƒãƒˆ (ãƒ‡ãƒ¼ã‚¿å‰Šé™¤)             |
| `npm run deploy:local` | LocalStackã¸ãƒ‡ãƒ—ãƒ­ã‚¤                            |
| `npm run deploy:dev`   | AWSé–‹ç™ºç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤                           |
| `npm run deploy:prod`  | AWSæœ¬ç•ªç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤                           |
| `npm run build`        | SAMãƒ“ãƒ«ãƒ‰                                       |
| `npm run validate`     | SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¤œè¨¼                             |
| `npm run lint`         | ESLintå®Ÿè¡Œ                                      |
| `npm run test`         | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                                      |
| `npm run doc:generate` | OpenAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ                         |

## ç’°å¢ƒå¤‰æ•°

### å…±é€šç’°å¢ƒå¤‰æ•°

ã™ã¹ã¦ã® Lambda é–¢æ•°ã§å…±é€šã®ç’°å¢ƒå¤‰æ•°ã§ã™ã€‚`template.yaml` ã® `Globals.Function.Environment.Variables` ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚

| å¤‰æ•°å                            | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ                               | èª¬æ˜                             |
| --------------------------------- | :--: | ---------------------------------------- | -------------------------------- |
| `STAGE`                           |  âœ…  | `dev`                                    | ç’°å¢ƒ (local/dev/prod)            |
| `LOG_LEVEL`                       |  -   | `INFO`                                   | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«                       |
| `ALLOWED_ORIGINS`                 |  -   | `*`                                      | CORS è¨±å¯ã‚ªãƒªã‚¸ãƒ³                |
| `CHAT_MODEL_ID`                   |  -   | `anthropic.claude-3-haiku-20240307-v1:0` | Bedrock ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ‡ãƒ«ID         |
| `EMBEDDING_MODEL_ID`              |  -   | `amazon.titan-embed-text-v1`             | Bedrock ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ID   |
| `PINECONE_API_KEY_PARAMETER_NAME` |  âœ…  | `/myelinbase/dev/pinecone-api-key`       | SSM Parameter Store ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å |
| `PINECONE_INDEX_NAME`             |  âœ…  | `myelinbase-documents`                   | Pinecone ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å          |
| `USE_BEDROCK`                     |  -   | `false`                                  | Bedrockä½¿ç”¨ãƒ•ãƒ©ã‚°                |

### é–¢æ•°å›ºæœ‰ã®ç’°å¢ƒå¤‰æ•°

#### Documents Function

| å¤‰æ•°å                 | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜                                  |
| ---------------------- | :--: | ---------- | ------------------------------------- |
| `TABLE_NAME`           |  âœ…  | -          | DynamoDB ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«å       |
| `BUCKET_NAME`          |  âœ…  | -          | S3 ãƒã‚±ãƒƒãƒˆå                         |
| `PRESIGNED_URL_EXPIRY` |  -   | `900`      | ç½²åä»˜ã URL ã®æœ‰åŠ¹æœŸé™ï¼ˆç§’ï¼‰         |
| `DYNAMODB_ENDPOINT`    |  -   | -          | DynamoDB ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰ |
| `S3_ENDPOINT`          |  -   | -          | S3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰       |

#### Chat Function

| å¤‰æ•°å                | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜                                |
| --------------------- | :--: | ---------- | ----------------------------------- |
| `TABLE_NAME`          |  âœ…  | -          | Chat History DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«å    |
| `DOCUMENT_TABLE_NAME` |  âœ…  | -          | Documents DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«å       |
| `USER_POOL_ID`        |  âœ…  | -          | Cognito User Pool ID                |
| `CLIENT_ID`           |  âœ…  | -          | Cognito Client ID                   |
| `USE_MOCK_BEDROCK`    |  -   | `false`    | ãƒ¢ãƒƒã‚¯ Bedrock ã‚’ä½¿ç”¨ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰ |

#### Trigger Function

| å¤‰æ•°å                    | å¿…é ˆ | èª¬æ˜                                    |
| ------------------------- | :--: | --------------------------------------- |
| `STATE_MACHINE_ARN`       |  âœ…  | Step Functions ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ ARN       |
| `PROCESSOR_FUNCTION_NAME` |  âœ…  | Doc Processor Lambda é–¢æ•°å             |
| `TABLE_NAME`              |  âœ…  | Documents DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«å           |
| `LOCALSTACK_ENDPOINT`     |  -   | LocalStack ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰ |

#### Processor / Cleanup Function

| å¤‰æ•°å                            | å¿…é ˆ | èª¬æ˜                             |
| --------------------------------- | :--: | -------------------------------- |
| `TABLE_NAME`                      |  âœ…  | Documents DynamoDB ãƒ†ãƒ¼ãƒ–ãƒ«å    |
| `BUCKET_NAME`                     |  âœ…  | Documents S3 ãƒã‚±ãƒƒãƒˆå          |
| `PINECONE_API_KEY_PARAMETER_NAME` |  âœ…  | SSM Parameter Store ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å |
| `PINECONE_INDEX_NAME`             |  âœ…  | Pinecone ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å          |
| `S3_ENDPOINT`                     |  -   | S3 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç”¨ï¼‰  |

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ç’°å¢ƒå¤‰æ•°

ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã¯ `local-dev/env.local.json` ã§è¨­å®šã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚è©³ç´°ã¯ [ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚¬ã‚¤ãƒ‰](./local-dev/LOCAL_DEVELOPMENT.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### ãƒ™ãƒ¼ã‚¹URL

- **é–‹ç™ºç’°å¢ƒ**: `https://<api-id>.execute-api.ap-northeast-1.amazonaws.com/dev`
- **æœ¬ç•ªç’°å¢ƒ**: `https://api.myelinbase.com`
- **ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ**: `http://localhost:3000`

### èªè¨¼

ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ Cognito JWT ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™ã€‚

```bash
# ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼
Authorization: Bearer <cognito-jwt-token>
```

### Documents API

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç®¡ç†æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                           | èª¬æ˜                 | è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ                                           |
| -------- | ------------------------------ | -------------------- | ---------------------------------------------------------- |
| GET      | `/documents`                   | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§å–å¾— | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |
| POST     | `/documents/upload`            | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLç™ºè¡Œ  | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |
| GET      | `/documents/{id}`              | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè©³ç´°å–å¾— | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |
| GET      | `/documents/{id}/download-url` | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLå–å¾—  | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |
| DELETE   | `/documents/{id}`              | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤     | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |
| PATCH    | `/documents/{id}/tags`         | ã‚¿ã‚°æ›´æ–°             | [è©³ç´°](./infrastructure/src/functions/documents/README.md) |

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:

```json
// GET /documents
{
  "documents": [
    {
      "documentId": "550e8400-e29b-41d4-a716-446655440000",
      "fileName": "sample.pdf",
      "status": "COMPLETED",
      "fileSize": 102400,
      "contentType": "application/pdf",
      "tags": ["é‡è¦"],
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:05:00.000Z"
    }
  ]
}
```

### Chat API

RAG ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹                           | èª¬æ˜                            | è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ                                               |
| -------- | ------------------------------ | ------------------------------- | -------------------------------------------------------------- |
| POST     | `/chat/sessions`               | ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ                  | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |
| GET      | `/chat/sessions`               | ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾—              | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |
| PATCH    | `/chat/sessions/{id}`          | ã‚»ãƒƒã‚·ãƒ§ãƒ³åæ›´æ–°                | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |
| DELETE   | `/chat/sessions/{id}`          | ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤                  | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |
| POST     | `/chat/sessions/{id}/messages` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°) | [è©³ç´°](./infrastructure/src/functions/chat/README.md)          |
| GET      | `/chat/sessions/{id}/messages` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´å–å¾—              | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |
| POST     | `/chat/messages/{id}/feedback` | ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡              | [è©³ç´°](./infrastructure/src/functions/chat-sessions/README.md) |

**ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:

Chat ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã¯ Lambda Function URL ã‚’ä½¿ç”¨ã—ã€Vercel AI SDK v3.x äº’æ›ã® NDJSON å½¢å¼ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é…ä¿¡ã•ã‚Œã¾ã™ã€‚

```
POST <ChatAgentEndpoint>/chat/stream
```

**ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:

```
0:"ã“ã‚“ã«ã¡ã¯"
0:"ã€"
0:"ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ"
0:"ã®"
0:"è¦ç´„"
0:"ã§ã™"
0:"ã€‚"
e:{"finishReason":"stop","usage":{"promptTokens":150,"completionTokens":50}}
d:{"finishReason":"stop"}
```

### OpenAPI ä»•æ§˜

å®Œå…¨ãª API ä»•æ§˜ã¯ [OpenAPI ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](./doc/openapi.yaml) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```bash
# OpenAPI ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆ
npm run doc:generate
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼

### ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‹ã‚‰å®Œäº†ã¾ã§

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Client â†’ POST /documents/upload                         â”‚
â”‚     - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆåå‰ã€ã‚µã‚¤ã‚ºã€ãƒãƒƒã‚·ãƒ¥ï¼‰ã‚’é€ä¿¡      â”‚
â”‚     - é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆfileHash ã«ã‚ˆã‚‹ï¼‰                        â”‚
â”‚     â†“                                                         â”‚
â”‚  2. Documents Lambda â†’ DynamoDB                              â”‚
â”‚     - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆstatus: PENDING_UPLOADï¼‰      â”‚
â”‚     â†“                                                         â”‚
â”‚  3. Documents Lambda â†’ S3                                    â”‚
â”‚     - ç½²åä»˜ãURLç™ºè¡Œï¼ˆæœ‰åŠ¹æœŸé™: 15åˆ†ï¼‰                       â”‚
â”‚     â†“                                                         â”‚
â”‚  4. Client â†’ S3 (ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)                            â”‚
â”‚     - ç½²åä»˜ãURLã‚’ä½¿ç”¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: RAG ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. S3 Event â†’ Trigger Lambda                                â”‚
â”‚     - s3:ObjectCreated:* ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡                      â”‚
â”‚     - S3 ã‚­ãƒ¼ã‹ã‚‰ documentId ã‚’æŠ½å‡º                          â”‚
â”‚     â†“                                                         â”‚
â”‚  6. Trigger Lambda â†’ DynamoDB                                â”‚
â”‚     - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ PROCESSING ã«æ›´æ–°                          â”‚
â”‚     â†“                                                         â”‚
â”‚  7. Trigger Lambda â†’ Step Functions                          â”‚
â”‚     - RAG ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’èµ·å‹•                                  â”‚
â”‚     â†“                                                         â”‚
â”‚  8. Step Functions ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ:                         â”‚
â”‚     a. ExtractText                                           â”‚
â”‚        - S3 ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«å–å¾—                                  â”‚
â”‚        - PDF/ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º                         â”‚
â”‚     b. ChunkText                                             â”‚
â”‚        - ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰   â”‚
â”‚        - ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚º: 1000æ–‡å­—ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—: 200æ–‡å­—   â”‚
â”‚     c. GenerateEmbeddings                                    â”‚
â”‚        - Bedrock Titan ã§ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°ç”Ÿæˆ                   â”‚
â”‚        - ãƒãƒƒãƒå‡¦ç†å¯¾å¿œ                                       â”‚
â”‚     d. UpsertVectors                                        â”‚
â”‚        - Pinecone ã«ãƒ™ã‚¯ãƒˆãƒ«ä¿å­˜                             â”‚
â”‚        - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã« documentId ã‚’å«ã‚ã‚‹                     â”‚
â”‚     e. UpdateStatus                                         â”‚
â”‚        - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ COMPLETED ã«æ›´æ–°                        â”‚
â”‚        - ã‚¨ãƒ©ãƒ¼æ™‚ã¯ FAILED ã«æ›´æ–°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é·ç§»

```text
PENDING_UPLOAD â†’ PROCESSING â†’ COMPLETED
                      â†“
                    FAILED
```

### å‰Šé™¤ãƒ•ãƒ­ãƒ¼

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: è«–ç†å‰Šé™¤                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Client â†’ DELETE /documents/{id}                         â”‚
â”‚     â†“                                                         â”‚
â”‚  2. Documents Lambda â†’ DynamoDB                              â”‚
â”‚     - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ DELETING ã«æ›´æ–°                            â”‚
â”‚     - TTL ã‚’è¨­å®šï¼ˆ24æ™‚é–“å¾Œï¼‰                                  â”‚
â”‚     â†“                                                         â”‚
â”‚  3. å³åº§ã« 202 Accepted ã‚’è¿”å´                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: ç‰©ç†å‰Šé™¤ï¼ˆéåŒæœŸï¼‰                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. TTL ã«ã‚ˆã‚Š DynamoDB ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•å‰Šé™¤                   â”‚
â”‚     â†“                                                         â”‚
â”‚  5. DynamoDB Streams: REMOVE ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«                     â”‚
â”‚     â†“                                                         â”‚
â”‚  6. Cleanup Lambda ãŒèµ·å‹•:                                    â”‚
â”‚     - S3 ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤                                         â”‚
â”‚     - Pinecone ãƒ™ã‚¯ãƒˆãƒ«å‰Šé™¤ï¼ˆdocumentId ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰     â”‚
â”‚     - ä¸¦åˆ—å‡¦ç†ã§å®Ÿè¡Œï¼ˆä¸€æ–¹ãŒå¤±æ•—ã—ã¦ã‚‚ä»–æ–¹ã¯ç¶™ç¶šï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è©³ç´°ã¯å„é–¢æ•°ã® README ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

- [Trigger Function](./infrastructure/src/functions/trigger/README.md)
- [Processor Function](./infrastructure/src/functions/processor/README.md)
- [Cleanup Function](./infrastructure/src/functions/cleanup/README.md)

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- **TypeScript strict ãƒ¢ãƒ¼ãƒ‰**ã‚’ä½¿ç”¨
- **`any` å‹ã¯ç¦æ­¢**ï¼ˆESLintã§æ¤œå‡ºï¼‰
- å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§é©åˆ‡ãªå‹ã‚¬ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- **Zod ã‚¹ã‚­ãƒ¼ãƒ**ã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨å‹ç”Ÿæˆ
- **ESLint** ã¨ **Prettier** ã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
myelinbase-backend/
â”œâ”€â”€ infrastructure/          # AWS SAM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ & Lambdaé–¢æ•°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ functions/       # Lambdaé–¢æ•°ç¾¤
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/        # ãƒãƒ£ãƒƒãƒˆAPI (ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°)
â”‚   â”‚   â”‚   â”œâ”€â”€ chat-sessions/ # ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ documents/   # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†API
â”‚   â”‚   â”‚   â”œâ”€â”€ processor/   # DynamoDB Streams ãƒ—ãƒ­ã‚»ãƒƒã‚µ
â”‚   â”‚   â”‚   â”œâ”€â”€ cleanup/     # TTLå‰Šé™¤ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”‚   â”‚   â”‚   â””â”€â”€ trigger/     # S3ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼
â”‚   â”‚   â””â”€â”€ shared/          # å…±æœ‰ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ & ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ template.yaml        # SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (AWSç’°å¢ƒ)
â”‚   â””â”€â”€ template-local.yaml  # SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ (ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ)
â”œâ”€â”€ local-dev/              # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
â”‚   â”œâ”€â”€ docker-compose.yml   # Docker Compose è¨­å®š
â”‚   â””â”€â”€ scripts/             # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â””â”€â”€ doc/                     # API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â””â”€â”€ openapi.yaml         # OpenAPIä»•æ§˜
```

### ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
npm run test:coverage

# ç‰¹å®šã®é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
npm run test -- src/functions/documents/
```

### ãƒ­ã‚°ç¢ºèª

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«: LocalStack ãƒ­ã‚°
npm run local:logs:localstack

# ãƒ­ãƒ¼ã‚«ãƒ«: å…¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°
npm run local:logs

# AWSé–‹ç™ºç’°å¢ƒ
npm run logs:dev

# AWSæœ¬ç•ªç’°å¢ƒ
npm run logs:prod

# ç‰¹å®šã®é–¢æ•°ã®ãƒ­ã‚°ï¼ˆSAM CLIï¼‰
cd infrastructure
sam logs --name DocumentsFunction --stack-name myelinbase-backend-dev --tail
```

### ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```bash
# ESLint å®Ÿè¡Œ
npm run lint

# ESLint è‡ªå‹•ä¿®æ­£
npm run lint:fix

# Prettier ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format

# SAM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¤œè¨¼
npm run validate
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### èªè¨¼ãƒ»èªå¯

- **Amazon Cognito** ã«ã‚ˆã‚‹ JWT ãƒ™ãƒ¼ã‚¹ã®èªè¨¼
- API Gateway Authorizer ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ï¼ˆownerId ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰

### ãƒ‡ãƒ¼ã‚¿ä¿è­·

- **S3 ãƒã‚±ãƒƒãƒˆã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢**ï¼ˆç½²åä»˜ãURLã®ã¿ï¼‰
- **SSM Parameter Store** ã«ã‚ˆã‚‹æ©Ÿå¯†æƒ…å ±ã®ç®¡ç†ï¼ˆPinecone API ã‚­ãƒ¼ï¼‰
- **DynamoDB ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢**

### å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

- **Zod ã‚¹ã‚­ãƒ¼ãƒ**ã«ã‚ˆã‚‹å³å¯†ãªå…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆæœ€å¤§ 50MBï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼åˆ¶é™ï¼ˆPDF, TXT, MD, DOCXï¼‰
- SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆDynamoDB ä½¿ç”¨ã«ã‚ˆã‚Šä¸è¦ï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **æœ€å°æ¨©é™ã®åŸå‰‡**: Lambda é–¢æ•°ã«ã¯å¿…è¦æœ€å°é™ã® IAM æ¨©é™ã‚’ä»˜ä¸
2. **ç’°å¢ƒå¤‰æ•°ã®æš—å·åŒ–**: æ©Ÿå¯†æƒ…å ±ã¯ SSM Parameter Store ã§ç®¡ç†
3. **CORS è¨­å®š**: è¨±å¯ã•ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
4. **ç½²åä»˜ãURLã®æœ‰åŠ¹æœŸé™**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã¯15åˆ†ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLã¯1æ™‚é–“

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»

```bash
# SAM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
npm run validate:lint

# ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
npm audit

# ä¾å­˜é–¢ä¿‚ã®æ›´æ–°
npm audit fix
```

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### CloudWatch ãƒ¡ãƒˆãƒªã‚¯ã‚¹

#### Lambda é–¢æ•°

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹             | èª¬æ˜         | ã‚¢ãƒ©ãƒ¼ãƒˆæ¨å¥¨é–¾å€¤ |
| ---------------------- | ------------ | ---------------- |
| `Invocations`          | å®Ÿè¡Œå›æ•°     | -                |
| `Errors`               | ã‚¨ãƒ©ãƒ¼æ•°     | > 10/åˆ†          |
| `Duration`             | å®Ÿè¡Œæ™‚é–“     | > 5ç§’ï¼ˆP95ï¼‰     |
| `Throttles`            | ã‚¹ãƒ­ãƒƒãƒˆãƒ«æ•° | > 0              |
| `ConcurrentExecutions` | åŒæ™‚å®Ÿè¡Œæ•°   | > 80%            |

#### DynamoDB

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹                   | èª¬æ˜                 | ã‚¢ãƒ©ãƒ¼ãƒˆæ¨å¥¨é–¾å€¤ |
| ---------------------------- | -------------------- | ---------------- |
| `ConsumedReadCapacityUnits`  | èª­ã¿å–ã‚Šå®¹é‡         | > 80%            |
| `ConsumedWriteCapacityUnits` | æ›¸ãè¾¼ã¿å®¹é‡         | > 80%            |
| `ThrottledRequests`          | ã‚¹ãƒ­ãƒƒãƒˆãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | > 0              |

#### Step Functions

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹           | èª¬æ˜           | ã‚¢ãƒ©ãƒ¼ãƒˆæ¨å¥¨é–¾å€¤ |
| -------------------- | -------------- | ---------------- |
| `ExecutionsStarted`  | å®Ÿè¡Œé–‹å§‹æ•°     | -                |
| `ExecutionsFailed`   | å¤±æ•—æ•°         | > 5/æ™‚é–“         |
| `ExecutionsTimedOut` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ•° | > 0              |

### CloudWatch Logs

#### ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—

- `/aws/lambda/myelinbase-{stage}-documents`
- `/aws/lambda/myelinbase-{stage}-chat`
- `/aws/lambda/myelinbase-{stage}-trigger`
- `/aws/lambda/myelinbase-{stage}-processor`
- `/aws/lambda/myelinbase-{stage}-cleanup`

#### ãƒ­ã‚°æ¤œç´¢ä¾‹

```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ¤œç´¢
aws logs filter-log-events \
  --log-group-name /aws/lambda/myelinbase-dev-documents \
  --filter-pattern "ERROR" \
  --start-time $(date -u -d '1 hour ago' +%s)000

# ç‰¹å®šã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDã®ãƒ­ã‚°
aws logs filter-log-events \
  --log-group-name /aws/lambda/myelinbase-dev-documents \
  --filter-pattern "doc-001"
```

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

#### æ¨å¥¨ã‚¢ãƒ©ãƒ¼ãƒˆ

1. **Lambda ã‚¨ãƒ©ãƒ¼ç‡ > 5%**
2. **Lambda å®Ÿè¡Œæ™‚é–“ > ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®80%**
3. **DynamoDB ã‚¹ãƒ­ãƒƒãƒˆãƒ«ç™ºç”Ÿ**
4. **Step Functions å®Ÿè¡Œå¤±æ•—**
5. **S3 ãƒã‚±ãƒƒãƒˆã‚µã‚¤ã‚º > 100GB**

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

CloudWatch ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ä»¥ä¸‹ã‚’å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

- Lambda é–¢æ•°ã®å®Ÿè¡ŒçŠ¶æ³
- DynamoDB ã®èª­ã¿æ›¸ãå®¹é‡
- Step Functions ã®å®Ÿè¡ŒçŠ¶æ³
- API Gateway ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã¨ã‚¨ãƒ©ãƒ¼ç‡

## ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### Lambda

- **ARM64 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã‚’ä½¿ç”¨ï¼ˆx86_64 ã‚ˆã‚Šç´„20%ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
- **é©åˆ‡ãªãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚º**ã®è¨­å®šï¼ˆéå‰°ãªãƒ¡ãƒ¢ãƒªã¯ä¸è¦ï¼‰
- **ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æ¸ˆã¿åŒæ™‚å®Ÿè¡Œæ•°**ã¯ä½¿ç”¨ã—ãªã„ï¼ˆå¾“é‡èª²é‡‘ï¼‰

### DynamoDB

- **ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰**ã‚’ä½¿ç”¨ï¼ˆäºˆæ¸¬ä¸èƒ½ãªãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼‰
- **GSI ã®æœ€å°åŒ–**ï¼ˆå¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ã¿ä½œæˆï¼‰
- **TTL ã®æ´»ç”¨**ï¼ˆä¸è¦ãªãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å‰Šé™¤ï¼‰

### S3

- **ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼**ã®è¨­å®šï¼ˆå¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•å‰Šé™¤ï¼‰
- **é©åˆ‡ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹**ã®ä½¿ç”¨ï¼ˆStandard â†’ Intelligent-Tieringï¼‰

### Step Functions

- **æ¨™æº–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ã‚’ä½¿ç”¨ï¼ˆExpress ã¯ä¸è¦ï¼‰
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®é©åˆ‡ãªè¨­å®š**ï¼ˆç„¡é§„ãªå®Ÿè¡Œæ™‚é–“ã‚’å‰Šæ¸›ï¼‰

### ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆæœˆé–“ï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹       | é–‹ç™ºç’°å¢ƒ   | æœ¬ç•ªç’°å¢ƒï¼ˆæ¨å®šï¼‰ |
| -------------- | ---------- | ---------------- |
| Lambda         | $5-10      | $20-50           |
| DynamoDB       | $5-10      | $30-100          |
| S3             | $1-5       | $10-30           |
| Step Functions | $1-3       | $5-20            |
| API Gateway    | $1-3       | $5-15            |
| Bedrock        | å¾“é‡èª²é‡‘   | å¾“é‡èª²é‡‘         |
| **åˆè¨ˆ**       | **$13-31** | **$70-215**      |

> **æ³¨æ„**: Bedrock ã®ã‚³ã‚¹ãƒˆã¯ä½¿ç”¨é‡ã«å¿œã˜ã¦å¤‰å‹•ã—ã¾ã™ã€‚è©³ç´°ã¯ [AWS Bedrock æ–™é‡‘](https://aws.amazon.com/bedrock/pricing/) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ

#### LocalStack ãŒèµ·å‹•ã—ãªã„

```bash
# ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
docker-compose ps

# ãƒ­ã‚°ç¢ºèª
npm run local:logs:localstack

# å®Œå…¨ãƒªã‚»ãƒƒãƒˆ
npm run local:reset:nocache
```

#### DynamoDB ã«æ¥ç¶šã§ããªã„

```bash
# ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ç¢ºèª
awslocal dynamodb list-tables

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
curl http://localhost:8000
```

#### S3 ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„

```bash
# é€šçŸ¥è¨­å®šç¢ºèª
awslocal s3api get-bucket-notification-configuration \
  --bucket myelinbase-local-docs

# æ‰‹å‹•ã§å†è¨­å®š
npm run deploy:local
```

### AWS ç’°å¢ƒ

#### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼

```bash
# ã‚¹ã‚¿ãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèª
aws cloudformation describe-stack-events \
  --stack-name myelinbase-backend-dev \
  --max-items 20

# ã‚¹ã‚¿ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã¦å†ãƒ‡ãƒ—ãƒ­ã‚¤
npm run delete:dev
npm run deploy:dev
```

#### Lambda ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

- ãƒ¡ãƒ¢ãƒªã‚µã‚¤ã‚ºã‚’å¢—ã‚„ã™ï¼ˆ512MB â†’ 1024MBï¼‰
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶ã°ã™ï¼ˆ30ç§’ â†’ 60ç§’ï¼‰
- å‡¦ç†ã‚’æœ€é©åŒ–ï¼ˆä¸¦åˆ—å‡¦ç†ã®æ´»ç”¨ï¼‰

#### DynamoDB ã‚¹ãƒ­ãƒƒãƒˆãƒ«

- ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ
- èª­ã¿å–ã‚Š/æ›¸ãè¾¼ã¿å®¹é‡ã‚’å¢—ã‚„ã™ï¼ˆã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§ã¯ä¸è¦ï¼‰

#### Step Functions å®Ÿè¡Œå¤±æ•—

```bash
# å®Ÿè¡Œå±¥æ­´ã‚’ç¢ºèª
aws stepfunctions list-executions \
  --state-machine-arn <arn>

# å¤±æ•—ã—ãŸå®Ÿè¡Œã®è©³ç´°
aws stepfunctions describe-execution \
  --execution-arn <execution-arn>
```

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. Pinecone æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Failed to connect to Pinecone`

**è§£æ±ºç­–**:

- SSM Parameter Store ã« API ã‚­ãƒ¼ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- Pinecone ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åãŒæ­£ã—ã„ã‹ç¢ºèª
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªï¼ˆVPC è¨­å®šãŒã‚ã‚‹å ´åˆï¼‰

#### 2. Bedrock ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦

**ç—‡çŠ¶**: `AccessDeniedException`

**è§£æ±ºç­–**:

- Bedrock ã®ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹åŒ–
- IAM ãƒ­ãƒ¼ãƒ«ã« Bedrock ã®æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### 3. CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `CORS policy: No 'Access-Control-Allow-Origin' header`

**è§£æ±ºç­–**:

- `ALLOWED_ORIGINS` ç’°å¢ƒå¤‰æ•°ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®URLã‚’è¨­å®š
- API Gateway ã® CORS è¨­å®šã‚’ç¢ºèª

## ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

### é–‹ç™ºãƒ•ãƒ­ãƒ¼

1. **Issue ã®ä½œæˆ**: ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½è¦æœ›ã¯ Issue ã§ç®¡ç†
2. **ãƒ–ãƒ©ãƒ³ãƒã®ä½œæˆ**: `develop` ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
3. **å®Ÿè£…**: ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆ
4. **Pull Request**: `develop` ãƒ–ãƒ©ãƒ³ãƒã«å‘ã‘ã¦ PR ã‚’ä½œæˆ
5. **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾Œã«ãƒãƒ¼ã‚¸

### ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

- `main`: æœ¬ç•ªç’°å¢ƒç”¨ï¼ˆä¿è­·ãƒ–ãƒ©ãƒ³ãƒï¼‰
- `develop`: é–‹ç™ºç’°å¢ƒç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒï¼‰
- `feature/*`: æ©Ÿèƒ½é–‹ç™ºç”¨
- `fix/*`: ãƒã‚°ä¿®æ­£ç”¨


### ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼

- ã™ã¹ã¦ã® PR ã¯æœ€ä½1åã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦
- CI ãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸‹ãŒã‚‰ãªã„ã“ã¨ã‚’ç¢ºèª

## é–¢é€£ãƒªãƒã‚¸ãƒˆãƒª

- [myelinbase-frontend](../frontend) - Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [AWS SAM Documentation](https://docs.aws.amazon.com/serverless-application-model/)
- [AWS Lambda Documentation](https://docs.aws.amazon.com/lambda/)
- [Amazon Bedrock Documentation](https://docs.aws.amazon.com/bedrock/)
- [Pinecone Documentation](https://docs.pinecone.io/)

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£é–¢é€£

- [RAG ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆ](./infrastructure/src/functions/trigger/README.md)
- [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ãƒ•ãƒ­ãƒ¼](./infrastructure/src/functions/documents/README.md)
- [ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½](./infrastructure/src/functions/chat/README.md)
- [å…±æœ‰ã‚³ãƒ¼ãƒ‰](./infrastructure/src/shared/README.md)

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ä½œè€…

Ryu

---

**æ³¨æ„**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ã®æƒ…å ±ã¯ [develop ãƒ–ãƒ©ãƒ³ãƒ](../../tree/develop) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
